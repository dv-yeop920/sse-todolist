const { join } = require('path')
const { inline, Spinner } = require('../../../utils/console')
module.exports = async (runtime, opts = {}) => {
  const spinner = new Spinner()
  spinner.start({
    text: 'Building modules..'
  })
  const sharedConfigPath = runtime.ENV.sharedConfigPath
  const build = require(join(require.resolve('next'), '../build/')).default
  const config = require('../../../utils/mergeConfigFile')(
    'plugins/next.config.js',
    'next.config.js',
    runtime
  )

  await build(runtime.project.CLIENT_DIR, config).catch(err =>
    inline.error(err)
  )
  spinner.stop()
  inline.success('build success!')
}
