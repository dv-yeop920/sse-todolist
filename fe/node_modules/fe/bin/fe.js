#!/usr/bin/env node
const debug = require('debug')
const { delimiter, join } = require('path')
const { stdout } = require('../utils/process')
const { determineRoot } = require('../utils/fs')
// const inspector = require('../utils/inspector')
const { resolve } = require('path')
const config = require('../config/fe.json')

debug('time-require').enabled && require('time-require')
// ;(debug('inspect').enabled || debug('i').enabled) && inspector()

process.env.DIRNAME = __dirname

// Add fe/node_modules as NODE_PATH
;(async () => {
  const nodePath = []
  nodePath.push(process.env.NODE_PATH || '')
  nodePath.push(resolve(__dirname, '../node_modules'))
  const out = await stdout('npm root -g').catch(err => '')
  out && nodePath.push(out)
  const appRoot = await determineRoot(
    config.FE_CONFIG_FILE,
    process.cwd()
  ).catch(err => '')
  appRoot && nodePath.push(join(appRoot, 'node_modules'))
  process.env.NODE_PATH = nodePath.join(delimiter)
  require('module').Module._initPaths()
  require('../index')
})()
