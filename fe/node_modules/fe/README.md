# FE

<img alt="npm version" src="https://img.shields.io/npm/v/fe.svg?style=flat-square"> <img alt="commitizen friendly" src="https://img.shields.io/badge/commitizen-friendly-brightgreen.svg?style=flat-square"> <img alt="code style: prettier" src="https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=flat-square">

Front-End workflow & stack

---

* ä¸šåŠ¡ä»£ç å›å½’ **æœ€ç®€å•** çš„ç»„ç»‡å½¢å¼:

  ```
  index.js
  server
    modules/
      user/
        index.js
  client
    pages/
      index.vue
  ```

* å¤šäººåä½œ / å¤š stage æ¨¡å¼ä¸‹ **ç»Ÿä¸€çš„** ç¯å¢ƒç®¡ç†

  ```sh
  # dev stage
  $ brew install fe

  # test stage
  $ apt-get install fe

  # production stage
  # docker intergration
  $ npm i fe -g
  ```

- **æ€§èƒ½**

  * [fastify](https://github.com/fastify/fastify) - The fastest and low overhead web framework

  * æœ€å°åŒ–ä¸šåŠ¡æ¥å£è€¦åˆ, æ ¹æ®ç¤¾åŒºæœ€ä½³å®è·µæŒç»­ä¸ºç”Ÿäº§ç¯å¢ƒä¼˜åŒ–, ä¸å†ä¸šåŠ¡ä¸­è€ƒè™‘æ€§èƒ½ä¼˜åŒ–ç‚¹

- less is more

æœ€å°çº¦æŸ, æœ€å¹¿æ³›çš„é¡¹ç›®ç±»ä¼¼æ¢³ç†, æ”¯æŒæ‰€æœ‰ç±»å‹é¡¹ç›®: SSR / SPA / vue-only / react-only / server-only

* **åŒæ„** æ¨¡å‹

åŸºäº [next](https://github.com/zeit/next.js/) | [nuxt](https://nuxtjs.org/) å®ç° react / vue åŒæ„

* å®Œå–„çš„ **ç”Ÿæ€** åœˆ

```sh
# List resource in fe stack
$ fe list
# Add deps
$ fe add
```

## node ç¯å¢ƒä¾èµ–

* node 8+

* npm / yarn(ä¼˜å…ˆ)

## å®‰è£…

ğŸ‰ğŸ‰ æ¨è **å†…ç½‘æ€¥é€Ÿå®‰è£…** ğŸ‰ğŸ‰

```sh
$ curl https://code.byted.org/snippets/162/raw -L -o - | sh
```

æ ‡å‡†å®‰è£…

```sh
$ yarn global add fe
# or
$ npm i fe -g
```

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€

ä¸€èˆ¬é¡¹ç›®å¼€å‘æµç¨‹ä¸º 1. é€šè¿‡è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›® 2. å¯åŠ¨ä½“éªŒè‰¯å¥½çš„å¼€å‘æ¨¡å¼ 3. éƒ¨ç½²ç®¡ç†

å¯¹åº”å‘½ä»¤ä¸º:

`fe init` Â» `fe dev` Â» `fe start`

### æ–¹å¼äºŒ

æ­¤å¤–ä¹Ÿå¯ä»¥å»ºä¸€ä¸ªç©ºçš„é¡¹ç›®ç›®å½•åŸåœ°å¯åŠ¨, å½“æ‰§è¡Œ `fe dev` æ—¶å€™ä¼šæ£€æŸ¥å’Œé€šè¿‡è¯¢é—®äº¤äº’çš„æ–¹å¼æœ€å°åŒ–é…ç½®é¡¹ç›®

```sh
$ mkdir project && cd project
$ fe dev
```

### ä»£ç é£æ ¼:

ä¸¥æ ¼ä½¿ç”¨ [prettier](https://prettier.io/), è¯·åŸºäºè‡ªå·±çš„ç¼–è¾‘å™¨é…ç½® [Editor Support](https://prettier.io/docs/en/editors.html)

æ ¼å¼å¦‚ä¸‹

```json
{
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "semi": false,
  "parser": "babylon",
  "singleQuote": true,
  "trailingComma": "none",
  "bracketSpacing": true,
  "jsxBracketSameLine": false,
  "overrides": [
    {
      "files": ".prettierrc",
      "options": { "parser": "json", "trailingComma": "none" }
    },
    {
      "files": ".babelrc",
      "options": { "parser": "json", "trailingComma": "none" }
    },
    {
      "files": "*.json",
      "options": { "trailingComma": "none" }
    }
  ]
}
```

## åŠŸèƒ½é›†:

* dev

  * å‰/åç«¯çƒ­æ›´æ–°
  * mock
  * proxy

* start

  * å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ(éœ€è¦å…ˆ build)

* add

  * å®‰è£…æ’ä»¶å¹¶åˆå§‹åŒ–é…ç½®?

* build

  * æ„å»ºç”Ÿäº§éƒ¨ç½²ä»£ç 

* static

  * é™æ€åŒ–äº§å‡ºç‰©(ç”¨ä»¥å®ç° H5 ç¦»çº¿åŒ–)

* env

  * æ£€æµ‹å¹¶å±•ç¤ºç¯å¢ƒä¿¡æ¯, ä¾¿äº DEBUG
  * å®ç°è‡ªæ£€ / è‡ªåŠ¨ä¿®å¤ / è­¦å‘Š

* list

  * å±•ç¤ºæ¨¡æ¿ / ç»„ä»¶ / ä¸­é—´ä»¶ / UI ç­‰ç”Ÿæ€ç¯å¢ƒ

* fd

  * å¯¹æ¥å…¬å¸ consul

## å‰ç«¯è·¯ç”±ç­–ç•¥

* "/" => `pages/[index.vue | index.js]`

* "/detail" => `pages/detail.vue`

* "/sub/detail" => `pages/sub/detail.vue`

## åŸºç¡€ä¸šåŠ¡ç±»å‹å’Œé¡¹ç›®ç»“æ„:

* vue-only

  ```
  â”œâ”€â”€ pages
      â””â”€â”€ *.vue
  ```

or

```
â”œâ”€â”€ client
    â””â”€â”€ pages
        â””â”€â”€ *.vue
```

* react-only

  ```
  â”œâ”€â”€ pages
      â””â”€â”€ *.js
  ```

  ```
  â”œâ”€â”€ client
      â””â”€â”€ pages
          â””â”€â”€ *.js
  ```

* server-only

  ```
  â””â”€â”€ index.js
  ```

* server+vue

  ```
  â”œâ”€â”€ index.js
  â””â”€â”€ pages
      â””â”€â”€ *.vue
  ```

* server+react

  ```
  â”œâ”€â”€ index.js
  â””â”€â”€ pages
      â””â”€â”€ *.js
  ```

## log æ—¥å¿—

åæ§½ï¼šfastify çš„æ—¥å¿—ä¸æ¡†æ¶è€¦åˆå¾—å¤ªæ·±ï¼Œå¯¼è‡´æ—¥å¿—çš„è‡ªå®šä¹‰é…ç½®æ¯”è¾ƒéº»çƒ¦

```javascript
//index.js å…¥å£æ–‡ä»¶
module.exports = async (app, options) => {
  // ....ä¸šåŠ¡ä»£ç 
}
// optå‚è€ƒï¼šhttps://github.com/fastify/fastify/blob/master/docs/Logging.md
module.exports.logger = opt
```

bytedance å†…éƒ¨ä½¿ç”¨

```javascript
//index.js å…¥å£æ–‡ä»¶
const { opt, hook } = require('byted-fastify-logger')()

module.exports = async (app, options) => {
  hook(app)
  // ....ä¸šåŠ¡ä»£ç 
}

module.exports.logger = opt
```

## ä¸šåŠ¡è‡ªå®šä¹‰ç­–ç•¥

### é…ç½®æ–‡ä»¶

å…¥å£æ–‡ä»¶: `/fe.json`

å¯¹æ¥ `fe` æ¡†æ¶çš„é…ç½®æ–‡ä»¶å…¨éƒ¨æ”¾åœ¨ `CONFIG_DIR`

> é€‰ç”¨ json æ ¼å¼, è€ƒè™‘åˆ° `fe` æŸäº›æƒ…å†µä¸‹éœ€è¦è¦†å†™(æ¯”å¦‚ 0 é…ç½®å¯åŠ¨æ—¶, æ£€æµ‹å®Œç½‘ç»œæƒ…å†µå)

### é»˜è®¤é…ç½®

> `fe.json` ä¸­è‡ªå®šä¹‰é…ç½®, ä¼˜å…ˆçº§ç­–ç•¥:

* babel é…ç½®ä¼˜å…ˆçº§: .babelrc(å¦‚æœå­˜åœ¨) > BABEL_CONFIG > é»˜è®¤é…ç½®
* ä¼˜å…ˆ `fe.json` , ä¸ä¸‹åˆ—é»˜è®¤é…ç½®æµ…åˆå¹¶

> å‘åå…¼å®¹ç­–ç•¥, åªå¢ä¸æ”¹

> ä¸€èˆ¬åœ°, å€¼ä¸º `""` çš„é¡¹éœ€è¦ç”±é¡¹ç›®æ¨¡æ¿ä¸­æŒ‡æ˜, æˆ–è€…ä¼šé€šè¿‡æ–‡ä»¶æ£€æŸ¥å’Œè¯¢é—®æ–¹å¼æ¥è‡ªåŠ¨é…ç½®

```js
// å½“å‰é¡¹ç›®ä¾èµ–ç‰ˆæœ¬, ä¾¿äºç”Ÿäº§ç¯å¢ƒå®æ–½å‘åç‰ˆæœ¬å…¼å®¹(éµå¾ª npm version)
// å¦‚æœåœ¨ package.json ä¸­å®‰è£…äº† `fe` ä¾èµ–, ä¼˜å…ˆçº§ package.json > fe.json
FE_VERSION: '^2.0.0'

// æŒ‡å®šåç«¯æœåŠ¡çš„å…¥å£æ–‡ä»¶, å¦‚æœå€¼ä¸º `null` æ„ä¸ºä¸éœ€è¦å…¥å£(çº¯å‰ç«¯é¡¹ç›®)
ENTRY_FILE: 'index.js'

// [vue | react] æŒ‡å®šå‰ç«¯æ¡†æ¶ç±»å‹, å¦‚æœå€¼ä¸º `null` æ„ä¸ºä¸ä¾èµ–å‰ç«¯æ¡†æ¶
CLIENT_MODE: ''

// å‰ç«¯ç›®å½•, çº¯å‰ç«¯é¡¹ç›®: "."; åŒ…å«å‰åç«¯ä¸šåŠ¡, æ¨è: "client",
CLIENT_DIR: ''

// æ— éœ€ç¼–è¯‘çš„ public èµ„æºç›®å½•(å¦‚ favicon)
// é»˜è®¤è®¿é—®è§„åˆ™ prefix + PUBLIC_DIR
// é»˜è®¤æ–‡ä»¶ç›®å½•ä¸º:
// - project
//   + public
//   + client
//   + server
// ä¾‹å¦‚:
// http://a.com/web/public/favicon.ico
PUBLIC_DIR: 'public'

// URL path prefix
// è®¿é—®å‰ç¼€
// åŒæ—¶å½±å“: client / server / public ä¸‰å±‚è®¿é—®æ–¹å¼éƒ½ä¼šå¢åŠ è®¿é—®å‰ç¼€
PREFIX_PATH: ''

// ç¼–è¯‘åçš„é™æ€èµ„æºè®¿é—®è·¯å¾„
// é»˜è®¤ä¸º "/"
// å½“éœ€è¦é…ç½® CDN æ—¶, è¿™é‡Œé…ç½®ä¸º CDN åœ°å€
// ä¾‹å¦‚:
// "PUBLIC_PATH": "//s3a.pstatp.com/caijing/caijing_insurance_quiz/"
PUBLIC_PATH: '/'

// å¿…é¡»çš„é¡¹ç›®é…ç½®æ–‡ä»¶(åŒæ—¶æ ‡ç¤ºé¡¹ç›®æ ¹ç›®å½•)
FE_CONFIG_FILE: 'fe.json'

// æŒ‡å®š polyfills æ–‡ä»¶å(ç½®äº config ç›®å½•ä¸­)
// å¦‚éœ€è¦†ç›–é»˜è®¤çš„æä¾›å¯¹åº”æ–‡ä»¶ (config/polyfills.js), å¦‚éœ€ç¦ç”¨é»˜è®¤çš„, æä¾›ç©ºæ–‡ä»¶
POLYFILLS_FILE: 'polyfills.js'
// æŒ‡å®š setupTests(å•æµ‹ç¯å¢ƒé…ç½®) æ–‡ä»¶å
SETUP_TESTS_FILE: 'setupTests.js'

// å‰ç«¯æ„å»ºç›®å½•
DIST_DIR: 'build'
// é¡¹ç›®çº§åˆ«æ‰©å±•é…ç½®æ–‡ä»¶ç›®å½•(éä¸šåŠ¡ç›¸å…³)
CONFIG_DIR: 'config'

// å¼€å‘æ¨¡å¼ä¸‹ä¼šå¯åŠ¨ä¸€ä¸ª mock æœåŠ¡, é€šè¿‡ `/_mock` è®¿é—®
MOCK_PREFIX: '/_mock'
// mock å­˜æ”¾ç›®å½•
MOCK_DIR: 'mock'

// æ˜¯å¦å¯åŠ¨æœåŠ¡ç«¯æ¸²æŸ“
ENABLE_SSR: true

// æ˜¯å¦å¯ç”¨ PWA
ENABLE_PWA: false

// é»˜è®¤åœ¨å¼€å‘ç¯å¢ƒæ·»åŠ  Access-Control-Allow-Origin CORS header
// ç”Ÿæˆç¯å¢ƒè¯·åœ¨ .env ä¸­é…ç½®
CORS_ORIGIN: '*'
CORS_METHODS: 'GET,HEAD,PUT,PATCH,POST,DELETE'

// æ˜¯å¦å¯ç”¨ https
ENABLE_HTTPS: false

// å¼€å‘æœåŠ¡å™¨ ip
DEV_SERVER_IP: '0.0.0.0'
// å¼€å‘æœåŠ¡å™¨å ç”¨ç«¯å£(ç”Ÿäº§ç¯å¢ƒé…ç½®ä»¥ `.env` æ–¹å¼æä¾›)
DEV_SERVER_PORT: 3000

// åˆ¤å®šæ˜¯å¦åœ¨å›½å†…, å½±å“ä»å“ªå®‰è£… npm åŒ…ç­‰ç­–ç•¥, é¡¹ç›®åˆå§‹åŒ–æ—¶æ£€æµ‹ä¸€æ¬¡, åç»­æ‰‹åŠ¨æ‰§è¡Œ `fe env` å†æ¬¡æ£€æŸ¥å¹¶æ›´æ–°
IN_CHINA: true
```

å…¶ä»–å†…ç½®æ’ä»¶é…ç½®æ–‡ä»¶:

```sh
config/plugins/
  webpack.config.js
  babel.config.js
  # å¼€å‘æ¨¡å¼ä¸‹ä¼šå¯åŠ¨ä¸€ä¸ª proxy æœåŠ¡
  proxy.config.js
  postcss.config.js
  ...
```

## ç¯å¢ƒå˜é‡

æ¯æ¬¡ä¸Šçº¿å‰ä¿è¯ `.env` , ç”¨ä»¥ç”Ÿäº§ç¯å¢ƒ

```
# é¡¹ç›®å”¯ä¸€æ ‡ç¤º
PSM=caijing.xx.xx
```

## TCE ä¸Šçº¿ç­–ç•¥

ç”Ÿäº§ç¯å¢ƒ server å¯åŠ¨æ—¶ä¼šæ£€æŸ¥ç¯å¢ƒå˜é‡: `IS_HOST_NETWORK` , å‘½ä¸­ "HOST" æ¨¡å¼å, ä¼šä¼˜å…ˆç»‘å®š `PORT0` (ç”± TCE æ³¨å…¥ç¯å¢ƒå˜é‡), å¦åˆ™ä¼šå‘½ä¸­ "bridge" æ¨¡å¼, è¯»å– `.env` æ–‡ä»¶ä¸­çš„ `SERVER_PORT` ä½œä¸ºç»‘å®šç«¯å£, ç®€å•æ¥è¯´: **HOST / AUTOHOST æ¨¡å¼ä¸‹ç»‘å®šç«¯å£ç”± TCE è‡ªåŠ¨åˆ†é…, BRIDGE æ¨¡å¼ä¸‹ç»‘å®šç«¯å£ä» .env > SERVER_PORT ä¸­è¯»å–**

## çƒ­æ›´æ–°ç­–ç•¥

* å‰ç«¯ Hot Module Reloading (å°½é‡ä¸åˆ·æ–°é¡µé¢)
* åç«¯çš„æ›´æ–°é¿å…è§¦å‘å‰ç«¯é‡æ–°ç¼–è¯‘
* æ”¯æŒ `fe.json`
* æ”¯æŒ `package.json` å®‰è£…æ–°æ¨¡å—åçƒ­æ›´æ–°

## `fe dev` å¯åŠ¨ç­–ç•¥:

1.  æ£€æŸ¥æ˜¯å¦å­˜åœ¨ `fe.json`

* NO
  * 1.  è¯¢é—®æ˜¯å¦åœ¨å½“å‰ç›®å½•è‡ªåŠ¨åˆ›å»º `fe.json` æˆ– "You'd better use `fe init [template name]` initialize a new project"
* YES - GOTO 2.

2.  æ£€æŸ¥ `CLIENT_MODE`

    * `null` - æŒ‰çº¯æœåŠ¡ç«¯å¯åŠ¨
    * å¦‚æœä¸º ""

      * æ£€æŸ¥ `CLIENT_DIR`, å¦‚æœä¸º "":

        * å¦‚æœå­˜åœ¨ç›®å½• `/pages` / `/client/pages` æ›´æ–° `CLIENT_DIR`,
        * å¦‚æœå­˜åœ¨ `CLIENT_DIR` å¯¹åº”ç›®å½•, æ£€æŸ¥ `/pages/*.vue` / `/client/pages/*.vue` è‡ªåŠ¨åˆ¤æ–­å‰ç«¯æ¡†æ¶, æ›´æ–° `CLIENT_MODE`

      * å¦åˆ™è¯¢é—® "Do you need vue / react as front-env framework and auto create pages folder?"
      * è¯¢é—® "Includes server business in your project?"
        * NO => åˆ›å»º `pages/index.vue` å¹¶æ›´æ–° `CLIENT_MODE` å’Œ `CLIENT_DIR`
        * YES => åˆ›å»º `client/pages/index.vue` å’Œ `server/.gitkeep`, å¹¶æ›´æ–° `CLIENT_MODE` å’Œ `CLIENT_DIR`

3.  æ£€æŸ¥ `ENTRY_FILE` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

* å¦‚æœä¸å­˜åœ¨è¯¢é—® "Not found index.js as entry file, auto generate a new file?", å¦‚æœé€‰ NO, é…ç½® `ENTRY_FILE` ä¸º `null`, å¦åˆ™åˆ›å»º:

```js
module.exports = async (app, options) => {
  app.get('/', (req, res) => {
    hello: 'world'
  })
  // app.register(require('./server/modules/user/'), { prefix: '/api/user' })
}
```

## `fe start` å¯åŠ¨ç­–ç•¥

* æ£€æŸ¥æ˜¯å¦å­˜åœ¨ `fe.json` æŠ›å‡ºé”™è¯¯ "Not specified fe.json"
* æ£€æŸ¥æ˜¯å¦å­˜åœ¨ build äº§å‡ºç‰©

## `fe init` ç­–ç•¥

download => replace => check in china => yarn / npm install

---

start | dev åŒºåˆ«

dev æ¨¡å¼ç”¨äºæœ¬åœ°å¼€å‘, å¿½ç•¥ `.env` ç¯å¢ƒå˜é‡, ç›¸å…³é…ç½®æ±‡æ€»åœ¨ `fe.json`;

åŒ…å« mock / æ–‡æ¡£ç­‰å¼€å‘æœåŠ¡

start æ¨¡å¼å°±æ˜¯çº¿ä¸Šè¿è¡Œç¯å¢ƒ, ä¼˜å…ˆä»¥ `.env` æ–¹å¼é…ç½®ç¯å¢ƒå˜é‡;

æœ€å°åŒ–å¯åŠ¨, æ€§èƒ½ä¼˜å…ˆ

ç¯å¢ƒåˆ¤æ–­:

1.  æŒ‰ä¸åŒæ‰§è¡Œå‘½ä»¤ => æ˜¾ç¤ºæ³¨å…¥åˆ° process.env.NODE_ENV = production|development
2.  ä¸šåŠ¡ä¸­åˆ¤æ–­ç¯å¢ƒæ¨¡å¼: const dev = process.env.NODE_ENV !== 'production'

---

ç›®å‰ require æ–¹å¼å¯¼è‡´ fe ä¸»å‘½ä»¤å¯åŠ¨å¤ªæ…¢

=> actions æŒ‰æ–‡ä»¶åˆ†æ‹†å‡ºå»

---

## css æ–¹æ¡ˆæ¢³ç†

#### ä¸»è¦åŸºäº postcss

#### è®¾è®¡å›¾

å°ºå¯¸çº¦å®šä¸º 750 x 1334

#### é…ç½®ä¼˜å…ˆçº§

`project/config/postcss.config.js` > `fe default`

#### æ–¹æ¡ˆé€‰å‹

* èµ„æºå¼•å…¥

  * postcss-import (default)
  * postcss-url (default)

- å±å¹•é€‚é…

  * postcss-px-to-viewport
  * postcss-viewport-units
  * viewport-units-buggyfill

* æ–°ç‰¹æ€§

  * postcss-cssnext (default å·²åŒ…å« autoprefixer)

- å‹ç¼© / æ¸…ç†æ— ç”¨

  * cssnano

- 1px
  * postcss-write-svg

é»˜è®¤é…ç½®:

```js
const createResolver = require('postcss-import-resolver')
module.exports = runtime => ({
  plugins: [
    require('postcss-import')({
      resolve: createResolver({
        alias: {
          '~': runtime.project.CLIENT_DIR,
          '~~': runtime.project.appRoot,
          '@': runtime.project.CLIENT_DIR,
          '@@': runtime.project.appRoot
        },
        modules: [
          runtime.project.CLIENT_DIR,
          runtime.project.appRoot,
          'node_modules',
          runtime.ENV.internalModulePath
        ]
      })
    }),
    require('postcss-url')(),
    require('postcss-cssnext')()
  ]
})
```

è‡ªå®šä¹‰é…ç½®: config/postcss.config.js

```js
module.exports = (config, runtime) => {
  config.plugins.push(
    require('autoprefixer')({
      /* ...options */
    })
  )
  return config
}
```

H5 çš„è‡ªå®šä¹‰é…ç½®æ¢³ç†: config/postcss.config.js

```js
module.exports = (config, runtime) => {
  config.plugins.concat([
    require('postcss-write-svg')({
      utf8: false
    }),
    require('postcss-px-to-viewport')({
      viewportWidth: 750,
      viewportHeight: 1334,
      unitPrecision: 3,
      viewportUnit: 'vw',
      selectorBlackList: ['.nvw', '.hairlines'],
      minPixelValue: 1,
      mediaQuery: false
    }),
    require('postcss-viewport-units')()
  ])
  return config
}
```

### ä½¿ç”¨æŒ‡å—

1.  èµ„æºå¼•å…¥

client ç›®å½• => `~` | `@`
root ç›®å½• => `~~` | `@@`

```css
@import 'cssrecipes-defaults'; /* == @import "../node_modules/cssrecipes-defaults/index.css"; */
@import 'normalize.css'; /* == @import "../node_modules/normalize.css/normalize.css"; */

@import 'foo.css'; /* relative to css/ according to `from` option above */

@import 'bar.css' (min-width: 25em);

.element {
  background: url('images/sprite.png');
}
```

```html
<img src="~assets/lark.png" alt="">
<img src="/public/lark.png" alt="">
```

> https://github.com/postcss/postcss-url > https://github.com/postcss/postcss-url

> https://github.com/postcss/postcss-import

2.  ä½¿ç”¨ cssnext

```css
/* custom properties */
:root {
  --fontSize: 1rem;
  --mainColor: #12345678;
  --highlightColor: hwb(190, 35%, 20%);
}

/* custom properties set & @apply rule */
:root {
  --centered: {
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

.centered {
  @apply --centered;
}

/* custom media queries */
@custom-media --viewport-medium (width <= 50rem);

/* some var() & calc() */
body {
  color: var(--mainColor);

  font-size: var(--fontSize);
  line-height: calc(var(--fontSize) * 1.5);
  padding: calc((var(--fontSize) / 2) + 1px);
}

/* custom media query usage */
@media (--viewport-medium) {
  body {
    font-size: calc(var(--fontSize) * 1.2);
  }
}

/* custom selectors */
@custom-selector :--heading h1, h2, h3, h4, h5, h6;
:--heading {
  margin-top: 0;
}

/* image-set function */
.foo {
  background-image: image-set(url(img/test.png) 1x, url(img/test-2x.png) 2x);
}

/* colors stuff */
a {
  color: var(--highlightColor);
  transition: color 1s; /* autoprefixed ! */
}
a:hover {
  color: gray(255, 50%);
}
a:active {
  color: rebeccapurple;
}
a:focus {
  background-color: rgb(255 153 0 / 33%);
  outline: 3px solid hsl(1turn 60% 50%);
}
a:any-link {
  color: color(var(--highlightColor) blackness(+20%));
}

/* font stuff */
h2 {
  font-variant-caps: small-caps;
}

table {
  font-variant-numeric: lining-nums;
}

/* filters */
.blur {
  filter: blur(4px);
}
.sepia {
  filter: sepia(0.8);
}

/* overflow-wrap fallback */
body {
  overflow-wrap: break-word;
}

/* attribute case insensitive */
[frame='hsides' i] {
  border-style: solid none;
}

/* system-ui font-family */
body {
  font-family: system-ui;
}
```

> http://cssnext.io/postcss/

3.  1px é€‚é…

```css
/*border-image*/
@svg 1px-border {
  height: 2px;

  @rect {
    fill: var(--color, black);
    width: 100%;
    height: 50%;
  }
}

.example {
  border: 10px solid transparent;
  border-image: svg(1px-border param(--color #00b1ff)) 2 2 stretch;
}

/*background-image*/
@svg square {
  @rect {
    fill: var(--color, black);
    width: 100%;
    height: 100%;
  }
}

#example {
  background: white svg(square param(--color #00b1ff));
}
```

> https://github.com/jonathantneal/postcss-write-svg

4.  å±å¹•é€‚é…

åŸºäº vw æ–¹æ¡ˆ, android 4.4 ä¸‹ polyfill å¤„ç†:

```
require('viewport-units-buggyfill').init();
```

å¯ç”¨ polyfill å, å¯å¤§èƒ†ä½¿ç”¨ `vw` `vh` `vmin` `vmax` å•ä½, åœ¨åŸºäºè®¾è®¡ç¨¿å¼€å‘æ—¶, è¯·ç¡®ä¿è®¾è®¡å›¾ä¸º 750 x 1334(å¦åˆ™è‡ªå®šä¹‰ `config/postcss.config.js`), åœ¨ css ä¸­ç›´æ¥æŒ‰è®¾è®¡å›¾å°ºå¯¸ä¹¦å†™ `px` å•ä½, é¢„ç¼–è¯‘é˜¶æ®µä¼šå°† `px` å•ä½è½¬æ¢ä¸º `vw`, å¦‚æœéœ€è¦å¿½ç•¥è½¬æ¢, è¯·æ·»åŠ  `.nvw` class

> https://github.com/rodneyrehm/viewport-units-buggyfill

---

é¡¹ç›®å¼€å‘è´¡çŒ®æŒ‡å—

#### å¼€å‘

1.  fork => MR => review => merge

2.  å¼€å‘æ—¶å»ºè®®æµ‹è¯•é©±åŠ¨, åœ¨ `test` ç›®å½•å…ˆå†™ case, å†å†™ä¸šåŠ¡ä»£ç 

```sh
$ npm run dev
```

> TIPS
> å¢åŠ  `DEBUG=inspect` ç¯å¢ƒå˜é‡(`DEBUG=inspect fe dev`) æ‰§è¡Œå¯ä»¥ç”¨ chrome devtools æ¥ debug node

3.  æ³¨æ„ git commit çš„ä»£ç æ ¼å¼

```sh
# git commit æ ¼å¼åŒ–
$ npm run commit
```

4.  æ³¨æ„ä»£ç é£æ ¼

#### å‘ç‰ˆæµç¨‹

1.  Commit changes


    ```sh
    $ git add .
    $ npm run commit
    ```

2.  Bump version via npm

    ```sh
    $ npm version patch
    ```

3.  Generate `CHANGELOG.md`

    ```sh
    $ npm run changelog
    ```

4.  Commit CHANGELOG

    ```sh
    $ npm run commit
    ```

5.  Release new version

    ```sh
    $ npm run release
    # scp ...
    ```

then, github release.. etc.

---

DEBUG æ–¹æ³•:

1.  pgrep -n node | xargs kill -USR1
2.  node -e "process.\_debugProcess(pid)"
3.  INSPECT=--inspect fe d
